<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Open Journal</title>

  <script>

    var userId = '{{userId}}';
    //alert(userId);
  </script>

  <script>
  function checkComment(comment){
    var img_id = comment;
    var split_arr = img_id.split("_");
    if(split_arr[3] == 1){
      var special_id = document.getElementById(img_id).firstElementChild;
      special_id.src = "../static/check.png"
      document.getElementById(img_id).classList.add('checked');
      document.getElementById(img_id).classList.remove('unchecked');
    }
  }
  </script>

  <script>
  function adapt(test){
    var img_id = test.id;
    var split_arr = img_id.split("_");

    var userId = '{{userId}}';
    if(document.getElementById(img_id).classList.contains('unchecked') && userId == split_arr[4] && userId != split_arr[2]){
      var special_id = document.getElementById(img_id).firstElementChild;
      special_id.src = "../static/check.png"
      document.getElementById(img_id).classList.add('checked');
      document.getElementById(img_id).classList.remove('unchecked');
      location.href ="adaptPaperComment?data="+split_arr;
    }
  }
  </script>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/customize.css" type="text/css" rel="stylesheet"/>
</head>
<body>
  <nav class="white" role="navigation">
    <ul id="dropdown1" class="dropdown-content">
      <li><a href="main_login" class="black-text">로그인</a></li>
      <li class="divider"></li>return str(filePath)
      <li><a href="main_new_member" class="black-text">회원가입</a></li>
      <li class="hiddenPage"><a href="main_mypage" class="black-text">마이 페이지</a></li>
    </ul>
    <div class="nav-wrapper container">
        <a id="logo-container" href="/" class="brand-logo"> Open Journal</a>
      <ul class="right hide-on-med-and-down">
      <li><a href="main_enroll">논문 검수 및 등록</a></li>
      <li><a href="main_view_fix_journal">논문 구독</a></li>
      <li><a href="main_comunity">커뮤니티</a></li>
      <li><a class="dropdown-trigger" href="#!" data-target="dropdown1">로그인<i class="material-icons right">arrow_drop_down</i></a></li>
      </ul>
      <ul id="nav-mobile" class="sidenav">
        <li><a href="main_enroll">논문 검수 및 등록</a></li>
        <li><a href="main_view_fix_journal">논문 구독</a></li>
        <li><a href="main_comunity">커뮤니티</a></li>
      </ul>
      <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons blue-text text-darken-4">menu</i></a>
    </div>
  </nav>

  <div id="loading_journal" style="display:none; margin:0px;" class="fixed center-align">
    <div style="margin:0px;" class="blue lighten-4 progress">
      <div class="blue darken-3 indeterminate"></div>
    </div>
    <span style="font-weight:bold;" class="blue-text text-darken-4">논문이 블록체인에 걸리는 데 약 1분 정도 소요됩니다.</span>
  </div>

  <div id="complete_journal" style="display:none; margin:0px;" class="fixed center-align">
    <div style="margin:0px;" class="progress">
        <div class="blue darken-3 determinate" style="width: 100%"></div>
    </div>
    <span style="font-weight:bold;" class="blue-text text-darken-4">논문이 성공적으로 등록되었습니다.</span>
  </div>




  {% for i in data %}
  <div  class="container">
    <div class="section">
      <div class="row" style="margin-bottom:0px;">
        <div style="border:1px solid #9e9e9e;" class="col s12 center">
          <table>
            <tbody>
              <tr>
                <td style="font-weight: bold" class="left">{{i.title}}</td>
                <td class="left" style="color:#9e9e9e;">|</td>
                <td class="left">{{i.mainCategory}}</td>
                <td class="left">-</td>
                <td class="left">{{i.subCategory}}</td>
                <td class="right blue-text" style="font-size:1.2rem; font-weight: bold">{{i.time}}</td>
              </tr>
            </tbody>
          </table>
          <div style="margin-bottom: 8px;" class="col s12 center">
          </div>
          <div class="s12 col center">
            <iframe id="journalPDF" style="width:80%; height:650px; overflow: hidden;" src="../static/journal/{{i.fileName}}">
            </iframe>

            <table class="journal_info">
              <tbody>
                <tr>
                  <td style="font-weight: bold;">
                    저자
                  </td>
                  <td>
                    {{i.writer}}
                  </td>
                </tr>
                <tr>
                  <td style="font-weight: bold;">
                    출처
                  </td>
                  <td>
                    파싱해 오거나 해야함 일단은 냅둠
                    전자공학회지 43(3), 2016.3. 64-71 (8 pages)<br>
                    The Magazine of the IEEE 43(3), 2016.3. 64-71 (8 pages)
                  </td>
                </tr>
                <tr>
                  <td style="font-weight: bold;">
                    Abstract
                  </td>
                  <td>
                    <p style="padding-left : 10px;text-align: left;">{{i.abstract}}</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="comment-window s12 col center">
            <ul>
              {% for j in i.commentDicts %}
              <li id={{j.commentNum}} class="comment-list">
                <table>
                  <tbody>
                    <tr id={{j.userId}}>
                      <td class="comment-name">
                        {{j.userName}}
                      </td>
                      <td class="comment-date">
                        {{j.Time}}
                      </td>

                      <td id="{{j.commentNum}}_{{i._id}}_{{j.userId}}_{{j.adaptFlag}}_{{i.user_id}}" onclick="adapt(this)" class="comment-check unchecked">
                        <img  style="height:10px; width:10px;" src="../static/uncheck.png"/>
                      </td>

                      <script>
                        checkComment("{{j.commentNum}}_{{i._id}}_{{j.userId}}_{{j.adaptFlag}}_{{i.user_id}}");
                      </script>

                      <td class="comment-blank">
                      </td>
                      <td class="comment-cancel">
                        <i class="tiny material-icons">cancel</i>
                      </td>
                    </tr>
                    <tr>
                      <td colspan="4" class="comment-contents">
                        {{j.comment}}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </li>
                {% endfor %}
            </ul>

            <form action="enrollPaperComment" method="POST">
              <textarea style="display:none", name="objectId", id = "objectId">{{i._id}}</textarea>
              <table>
                <tbody>
                  <tr>
                    <td class="comment-window-first-td">
                      <div class="input-field col s12">
                        <textarea id="comment" name="comment" class="materialize-textarea"></textarea>
                      </div>
                    </td>
                    <td class="comment-window-second-td" name="enroll">
                        <input type="submit" class="center btn blue darken-4" name="enrollBtn" value="등록" />
                    </td>
                  </tr>
                </tbody>
              </table>
          </form>

          <table>
       	    <tbody>
              <tr>
                <td class="s12 center">
                  <div onclick='openTotalJournal()' class="center btn blue darken-4">
                    <span>구독</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>

        </div>
      </div>
    </div>
  </div>
  {% endfor %}

  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
  <script src="js/customize.js"></script>
  <script src="js/web3.min.js"></script>
  <script src="js/truffle-contract.js"></script>
	<script src="js/app.js"></script>
	<script src="js/finalenroll.js"></script>

  </body>
</html>
